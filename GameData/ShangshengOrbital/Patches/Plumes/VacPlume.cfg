@PART[*]:HAS[@SHANGSHENGPLUME[VacPlume]]:FOR[ShangshengPlume]:NEEDS[SmokeScreen] {
  !EFFECTS {}
  %EFFECTS
  {
    %KeroVac {
      MODEL_MULTI_SHURIKEN_PERSIST {
        //Get the inputs from the other config.
        transformName = #$../../../SHANGSHENGPLUME[VacPlume]/transformName$
        localRotation = #$../../../SHANGSHENGPLUME[VacPlume]/localRotation[0]$,$../../../SHANGSHENGPLUME[VacPlume]/localRotation[1]$,$../../../SHANGSHENGPLUME[VacPlume]/localRotation[2]$
        localPosition = #$../../../SHANGSHENGPLUME[VacPlume]/flarePosition[0]$,$../../../SHANGSHENGPLUME[VacPlume]/flarePosition[1]$,$../../../SHANGSHENGPLUME[VacPlume]/flarePosition[2]$
        fixedScale    = #$../../../SHANGSHENGPLUME[VacPlume]/flareScale$
        //
        name = flare
        modelName = ShangshengOrbital/FX/smokescreen/NL1Flare
        fixedEmissions = false

        size = 0.3
        linGrow = 1
        logGrow = 3
        emission = 2
        speed = 0.3
        energy = 0.3
        zForce = 1.1
      }

      MODEL_MULTI_SHURIKEN_PERSIST {
        //Get the inputs from the other config.
        transformName = #$../../../SHANGSHENGPLUME[VacPlume]/sideTransformName$
        localRotation = #$../../../SHANGSHENGPLUME[VacPlume]/localRotation[0]$,$../../../SHANGSHENGPLUME[VacPlume]/localRotation[1]$,$../../../SHANGSHENGPLUME[VacPlume]/localRotation[2]$
        localPosition = #$../../../SHANGSHENGPLUME[VacPlume]/flarePosition[0]$,$../../../SHANGSHENGPLUME[VacPlume]/flarePosition[1]$,$../../../SHANGSHENGPLUME[VacPlume]/flarePosition[2]$
        fixedScale    = #$../../../SHANGSHENGPLUME[VacPlume]/flareScale$
        //
        name = flareSide
        modelName = ShangshengOrbital/FX/smokescreen/NL1Flare
        fixedEmissions = false

        @fixedScale *= 0.3
        size = 0.3
        linGrow = 1
        logGrow = 3
        emission = 2
        speed = 0.3
        energy = 0.5
        zForce = 1.1
      }

      MODEL_MULTI_SHURIKEN_PERSIST {
        //Get the inputs from the other config.
        transformName = #$../../../SHANGSHENGPLUME[VacPlume]/transformName$
        localRotation = #$../../../SHANGSHENGPLUME[VacPlume]/localRotation[0]$,$../../../SHANGSHENGPLUME[VacPlume]/localRotation[1]$,$../../../SHANGSHENGPLUME[VacPlume]/localRotation[2]$
        localPosition = #$../../../SHANGSHENGPLUME[VacPlume]/plumePosition[0]$,$../../../SHANGSHENGPLUME[VacPlume]/plumePosition[1]$,$../../../SHANGSHENGPLUME[VacPlume]/plumePosition[2]$
        fixedScale    = #$../../../SHANGSHENGPLUME[VacPlume]/plumeScale$
        //
        name = plume
        modelName = ShangshengOrbital/FX/smokescreen/NL1Vac
        fixedEmissions = false

        size = 0.1
        emission = 1
        speed = 0.2
        energy = 1.2
        linGrow = 24
        offset = 0.05
        randConeEmit = 0
        zForce = 1.03
      }

      AUDIO
			{
				channel = Ship
				clip = sound_rocket_spurts
				volume = 0.0 0.0
				volume = 1.0 1.0
				pitch = 0.0 0.2
				pitch = 1.0 1.0
				loop = true
			}
    }
  }
}

@PART[*]:HAS[@SHANGSHENGPLUME[VacPlume]]:FOR[ShangshengPlume]:NEEDS[SmokeScreen] {
  @EFFECTS
  {
    @KeroVac {
      @MODEL_MULTI_SHURIKEN_PERSIST[*],* {
        decluster = True
        emitOnUpdate = True
      }
    }
  }
}

@PART[*]:HAS[@SHANGSHENGPLUME[VacPlume],@EFFECTS:HAS[!engage]]:FOR[ShangshengPlume]:NEEDS[SmokeScreen]
{
  @EFFECTS
  {
    // disengage
    // {
    //   AUDIO
    //   {
    //     channel = Ship
    //     clip = sound_vent_soft
    //     volume = 0.7
    //     pitch = 1.4
    //     loop = false
    //   }
    // }
    engage
		{
			AUDIO
			{
				channel = Ship
				clip = sound_vent_soft
				volume = 1.0
				pitch = 2.0
				loop = false
			}
		}
		flameout
		{
			PREFAB_PARTICLE
			{
				prefabName = fx_exhaustSparks_flameout_2
				transformName = smokePoint
				oneShot = true
			}
			AUDIO
			{
				channel = Ship
				clip = sound_explosion_low
				volume = 1.0
				pitch = 2.0
				loop = false
			}
		}
  }
}
